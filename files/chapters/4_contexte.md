# Contexte et environnement

## Un peu d'histoire

### Les débuts du groupe

C'est par la convention du **31 août 1937** entre l'état et les acteurs ci-après qu'est établi l'unification du réseau ferré français. 

- [Compagnie du chemin de fer du Nord][1]
- [Compagnie du chemin de fer de l'Est][2]
- [Compagnie du chemin de fer de Paris à Orléans][3] *(PO)*
- [Compagnie du chemin de fer du Midi][4]
- [Compagnie du chemin de fer de Paris à Lyon et à la Méditerranée][5] *(PLM)*  

Les deux Syndicats du chemin de fer de la [Grande Ceinture][6] et de la [Petite Ceinture][7].  
Et les des deux administrations nationales, [les chemins de fer d'Alsace Lorraine](https://fr.wikipedia.org/wiki/Administration_des_chemins_de_fer_d%27Alsace_et_de_Lorraine), [Réseau de l'état](https://fr.wikipedia.org/wiki/Administration_des_chemins_de_fer_de_l%27%C3%89tat).

Celle-ci prévoit pour une durée de **45 ans** que l'état possède 51% du capital, les 49% restants étant pour les actionnaires des sociétés financières succédant aux anciennes companies.

Cette unification prend effet le **1er janvier 1938** pour former la nouvelle **SNCF**, celle-ci exploite alors un réseau de **42,500km** de voies dont **8%** électrifiées, le tout géré par **515,000** cheminots.

### Transformation en EPIC

C'est le 1er janvier 1983, à terme de la convention, que l'ensemble des actifs revient à l'état qui décide de faire de la SNCF un *Établissement Public à caractère Industriel et Commercial*.  
Le TGV est alors commercialisé depuis plus d'un an.  
La marque TER est créée en 1987.  

### Séparation et création de RFF

En 1990, la [directive européenne 91/440](https://fr.wikipedia.org/wiki/Directive_relative_au_d%C3%A9veloppement_de_chemins_de_fer_communautaires) vise à permettre une ouverture à la concurrence. Celle-ci impose la séparation de la gestion de l'infrastructure et de l'exploitations des services de transport.
C'est le **13 février 1997** qu'en réponse à cette directive, un nouvelle EPIC est créé, Réseau Ferré de France *(RFF)* par scission de la SNCF. RFF est désormais le propriétaire de l'infrastructure et décide désormais de l'aménagement, du développement et de la valorisation du réseau.  

Le rapport de la Cour des comptes de 2007 relève que la séparation entre gestion de l'infrastructure et de l'exploitation telle qu'elle a été effectuée en 1997 allait « au-delà des exigences » de l'article 1 de [la directive 91-440](https://fr.wikipedia.org/wiki/Directive_relative_au_d%C3%A9veloppement_de_chemins_de_fer_communautaires), qui n'exigeait qu'une séparation comptable.

### Réunification et création des trois EPIC

Suite à de nombreux de problèmes liées à la séparation des deux entités, le Sénat et l'Assemblée nationale constitue une nouvelle réforme en SNCF. Celle-ci prévoit la réunification de la SNCF et RFF. Elle prévoit aussi une réorganisation de la SNCF en trois EPIC:

- **SNCF**, l'EPIC de tête, la gouvernance du groupe.
- **SNCF Réseau**, gestionnaire de l'infrastructure.
- **SNCF Mobilité**, chargé de l'exploitation.

![Trois EPIC](./assets/sncf-epic.png)

### La SNCF aujourd'hui

En 2016, les trois EPIC emploient **146,623 salariés** et compte **260,000 collaborateurs**. Avec un chiffre d'affaires de **31,4 Md€** donc **33%** réalisés à l'international, le groupe transporte **13,5 millions** de voyageurs chaque jour, il est présent dans **120** pays.

En 2017 **Keolis**, filiale privé de SNCF Mobilités, opérateur de transport public, est le leader mondial du metro automatique et du tramway, avec **61,070 salariées** répartis dans dix-sept pays à travers le monde et un chiffre d'affaires de **5,399 Md€**.  
C'est lui qui exploite par exemple le réseau Divia.  

### L'ère du digital

L'arrivé et la croissance exponentielle de l'informatique et du digital confronte aujourd'hui le groupe à de nouvelles problématiques mais aussi de nouvelles opportunités.
Le groupe est acteur dans de nombreuses nouvelles innovations, pour n'en citer que quelques unes:

- [Investissements et exploitation](https://www.usine-digitale.fr/article/keolis-et-valeo-misent-sur-la-navette-autonome-navya-leve-30-millions-d-euros.N449887) conjointement avec Navya de deux navette 100% autonome à Lyon depuis 2016 et Los Angeles depuis cette année.
- 2017, [création d'ALTAMETRIS](https://www.sncf-reseau.fr/fr/actualite/institutionnel/lancement-de-la-filiale-drones-sncf-reseau-altametris), filiale de SNCF Réseau, traitements de données sur le réseau acquises par drones et robots.

Bien que l'informatique soit présente depuis le début au service des voyageurs:

![Site SNCF Minitel](./assets/sncf-minitel.jpg)

Elle cherche encore sa place dans le reste des organisations qui constitue la SNCF, c'est le cas du pôle dont je fais partie.

## Ma situation dans l'entreprise

Pour pouvoir me situer dans cette grande entreprise, je vous propose de descendre la hiérarchie depuis le sommet:

### SNCF Mobilités

Comme rapporté précédemment, c'est l'un des trois grands EPIC qui compose la SNCF.
Cette entité est chargé de l'exploitation des trains de voyageurs et de marchandises en France.  
En 2015 elle emploie près des 2/3 des effectifs de la SNCF.

### SNCF Matériel

Cette entité à pour charge la maintenance du matériels roulants, ce qui représente près de 17,000 machines.  
Ce dispositif est répartit dans 4 entités distinctes:

- La direction du matériel
- Les entités d'ingénierie
- Les entités support (Technicampus et CLI)
- Les 38 technicentre (28 de maintenance et 10 industriels)

### Technicentre Bourgogne Franche Comté

Le **TBFC** se situe est répartit sur quatres sites:

- Le site de Perrigny, *le site principal ou je me situe*
- Le site de Dijon ville
- Le site de Gevrey
- Le site de Besançon

Le technicentre à pour rôle la maintenance du parc des locomotives et wagons TER et FRET de la région.  

Il est dirigé par *Sylvain Miguet*, et est plus ou moins répartit selon les services suivants:

- Appui Production
- STF BFC, *(Supervisions techniques de flotte)*
- GEF
- QSE
- RH *(Ressource humaines)*
- Amélioration continue
  - Installation et outillages
  - Cellule Digitale
- UO TER *(Unité Opérationelle)*
- UO LOC Wagon Station *(Unité Opérationelle)*

### Pole Amélioration Continue

Le pole amélioration continue à pour but, l'amélioration des processus du Technicentre.  

Celui-ci est sous la direction de *Lionel Ramos* mon tuteur actuel.

Il est donc divisé en deux pôles, installation et outillages, qui a pour mission l'amélioration de l'environement de travail par le biais de nouveaux outils ou infrastructure, et la Cellule digitale.

### Cellule Digitale

#### Création

Comme je le précisais plus tôt, l'informatique apporte de nouveaux défis mais aussi de nouvelles opportunitées:  
C'est dans ce cadre que s'inscrit la cellule digitale. Cette initiative est relativement nouvelle, en effet l'informatique de proximité est loin d'être la règle actuellement à la SNCF.

Depuis sa création, il y à un peu plus de quatres ans, elle à pour rôle le développement et la maintenance de nombreuses applications pour répondre au problèmatiques de l'amélioration continu des processus du technicentre.

> Demander précision Alan, Lionel, Sylvain

#### Composition

Durant mon alternance, la cellule digitale a été composé du personnel suivant:

- **Alan Morin**, Développeur titulaire
- **Kevin Dos Santos**, Alternant Développeur *(jusqu'en juillet 2018)*
- **Christophe Chuy**, Alternant Développeur *(jusqu'en novembre 2017)*
- Moi même  

#### Acteurs concernés

Le travail de la cellule peut aussi bien concerner les unitées de production que les autres fonctions supports, cela varie selon les projets.  

## Contexte technique

### Réseau, Active Directory, et serveur proxy

La SNCF dispose d'un grand réseau intranet accessible seulement depuis l'intérieur ou par le biais de serveur proxys.  

L'entiéreté du parc d'ordinateur de la SNCF fonctionne sont windows 7 et windows 10. La migration est en cours depuis un an déjà mais certaines contraintes logicielles et la quantité de matérielle à migrer ralentisse le processus.  

Chaque Agent SNCF, Alternant, Stagiaire ainsi que certains prestataires de services disposent d'un compte SNCF, avec un CP *(identifiant)* et un mot de passe, le tout géré par un Active Directory Windows Server.

Le proxy est un proxy NTLM, celui-ci régit tout le flux entrant et sortant vers internet.  

En tant que développeur, nous devons reconfigure chaque nouveau logicielle pour l'utiliser.

### Stack de développement

La cellule digitale, développe essentiellement des applications web et web mobile, disponible sur l'intranet de l'entreprise, je me pencherai plus précisément sur la questions du déploiement par la suite.  

> En écrivant ce rapport, je me suis rendu compte que toutes les technologies que nous utilisons pour développer sont open source.

Voici les technologies que j'ai été amené à manipuler durant cette année:  

#### Angular 2

Framework javascript front-end qui permet de créer des Single Page Application par le biais de composant et bindings MVVM.  

**MVVM**, *Model View ViewModel*, est en fait un dérivé du modèle MVC le controleur est simplement remplacé par le ViewModel, la différence entre ces deux modèles réside surtout dans une chose, le 2 way data binding, c'est à dire que les changement effectué dans la View sont reflétté directement dans la ViewModel est vice-versa.

Dans le cas d'angular, un composant est en fait composé de:

- Une classe, *Typescript*, ViewModel, la logique de présentation
- Un template et une feuilles de style, *HTML + SCSS/CSS*, la vue

#### AngularJS

AngularJS est une précédente version du framework, bien que présentant des concepts similaires, ils ne fonctionnent pas du tout pareil, ils utilise même un langage différent.

> Beaucoup considère que google à fait une erreur en gardant le même nom pour ces deux projets qui au final ne sont pas les mêmes.

Nous ne développons plus de nouvelles applications avec AngularJS mais il nous reste d'anciennes applications en maintenances.

#### Ionic3

Ionic est un framework construit autour d'angular visant spécifiquement les plateformes mobiles, il permet notamment via des plugins de crée des applications installables accédant directement au API natives.

Nous n'avons pas d'example en production, nous nous en sommes servis principalement pour du prototypage.

#### Spring boot 1.5

Spring est un framework backend Java. Spring boot est une surcouche permettant de créée des projets Spring avec moins de configuration.

#### Base de données

Pour ce qui est des bases de données nous nous servons des technologies suivantes:  

- **Postgresql**, base de données SQL
- **CouchDB**, base de données NOSQL accessible via une API HTTP
- **PouchDB**, module javascript frontend offrant de nombreux outils pour l'utilisation d'une base CouchDB

#### Node.js

Node.js est un *runtime environement* pour javascript, c'est à dire, qu'il sert à faire éxécuter du code Javascript par une machine.  

Contrairement à ce que l'on pourrait croire, ils ne sert pas uniquement à développer des serveurs, il est présent dans tout l'écosystème javascript.  

Dans notre cas, nous nous en servons tout les jours pour Angular et autres.

### Langage

- **Javascript**, il n'est plus nécessaire de le présenté, c'est le langage interprété par tout les navigateurs depuis bien longtemps.
- **Typescript**, est un langage développé par Microsoft qui compile vers javascript, celui-ci rajoute les notions de typages dynamiques.
- **HTML**, pour les templates angular et autres
- **CSS**, pour les feuilles de styles
- **SCSS**, langage qui compile vers CSS, il permet de rajouter des fonctions, variables, etc...
- **Java**, dans le cadre de spring.

### Logiciels utilisées

#### VSCode

VSCode est un IDE Open Source léger développé par Microsoft, celui-ci vise principalement les environement front-end et back end Javascript et Typescript.  Mais grace à son modèle d'extensibilité et ses nombreux plugins, tends à devenir aussi complet que n'importe quelle IDE.  
En plus d'être gratuit, il est très simple d'utilisation, demande peu de performance, et les extensions sont facile à créée.  

J'en ai d'ailleurs créée une sur mon temps libre pour me permettre de refactor les composants Angular.

#### PGAdmin

PGadmin est un outil d'administration de base de données, nous nous en servons pour mettre à jour et effacé les données simplement en phase de développement.

### Navigateur cible

#### Firefox ESR *(desktop)*

C'est la plateforme principale que nous visons et le navigateur recommandé aujourd'hui à la SNCF, il s'agit en fait d'un build custom de firefox déployé par une équipe de la Direction de la Sécurité à Lyon.

#### Google Chrome *(desktop)*

Depuis peu, il est possible d'installer google chrome sur les postes. C'est la dernière version à jour de Google Chrome, avec quelques paramètres de désactivés.  

Malgrès nos nombreuses questions à ce sujet, nous ne savons pas dans quelle démarche cela s'inscrit, surtout au niveau sécurité en comparaison au build custom de Firefox. Google Chrome n'étant pas Open Source, ormis dans sa version Chromium qui n'est pas celle que nous utilisons.  

#### Internet Explorer *(desktop)*

Nous ne visons pas cette plateforme au sein de la cellule digitale. L'unique raison pour la quelle IE est encore utilisé est du certaines anciennes applications ne fonctionne que sous internet explorer.

#### Safari *(ios)*

Une partie de la flotte mobile de la SNCF utilisant des Iphone, safari est aussi un des navigateurs que nous ciblons.  

Celui-ci étant basé sur le même moteur que chrome, blink, il nous est rare d'avoir des problèmes avec.

#### Mobile Iron, Web@Work *(android)*

Pour terminer, la plus grande partie de la flotte mobile de la SNCF fonctionne sous android, hors pour pouvoir accéder au proxy sous Android, la solution qui a était retenu est Mobile Iron.  

En effet, les portables ne disposent pas d'un accés direct au réseau, il passent d'abord par le réseau internet mobile.  

Or, Mobile Iron, qui est donc une surcouche logicielle du système Android, fournit plusieurs logiciel propriétaire dont, le navigateur Web@Work. Ce dernier est basé sur une ancienne version de chromium et modifie énormément de paramètres.  

C'est une grande source de contraintes pour nous, la version de chromium n'étant pas à jour, beaucoup de nouvelles spécifications CSS et HTML ne fonctionnent pas. Le navigateur ne dispose d'ailleurs d'aucune documentation quant au fonctionnalités supporté ou modifié.  

### Déploiement des applications

Le déploiement de nos applications et géré par DDSIM, La direction des services informatiques du matériel. Situé à Lyon elle nous fournit le déploiement de nos applications, base de données et serveur "as a service".

Ce sont aussi eux qui gère la réplication et la stabilité des base de données.

Ce service proposent les environements suivant :

#### Développement

L'environement de développement, il nous est fournit pour pouvoir prototyper et développer nos applications uniquement.

Le matériel utilisé est moins robuste et stable que pour les autres environement, en effet, en cas de panne, il n'affecte que les développeurs, cela permet de réduire les coûts lié à l'infrastructure.

#### Recette

Cette environement est dédié au test utilisateurs restreint, 5/10 utilisateurs maximum.

Le matériel est, comme pour l'environement de développement, moins robuste que le reste.

#### Pilote

C'est l'environement de pré-production. A ce moment, sa stabilité n'est pas encore garantie, les serveurs supporte cependant une charge supérieur que sur les précédents environements et sont plus stable.  
Dans cette environement, il est possible que tout les utilisateurs supposés se servent de l'outil. Il est cependant de mise que s'il remplace d'anciennes procédures, celle-ci soit toujours effectué conjointement en cas de panne ou d'erreur sur l'application

#### Production

Enfin, l'environement de production correspond à une phase du produit ou les anciennes procédures ne sont plus utilisées, le produit est censé être stable.  

En enviroment de production, les bases de données sont répliqués pour résister en cas de défection matériel, les serveurs supportes aussi une charge plus conséquente de requête.


[1]: https://fr.wikipedia.org/wiki/Compagnie_des_chemins_de_fer_du_Nord
[2]: https://fr.wikipedia.org/wiki/Compagnie_des_chemins_de_fer_de_l%27Est
[3]: https://fr.wikipedia.org/wiki/Compagnie_du_chemin_de_fer_de_Paris_%C3%A0_Orl%C3%A9ans
[4]: https://fr.wikipedia.org/wiki/Compagnie_des_chemins_de_fer_du_Midi_et_du_Canal_lat%C3%A9ral_%C3%A0_la_Garonne
[5]: https://fr.wikipedia.org/wiki/Compagnie_des_chemins_de_fer_de_Paris_%C3%A0_Lyon_et_%C3%A0_la_M%C3%A9diterran%C3%A9e
[6]: https://fr.wikipedia.org/wiki/Ligne_de_la_grande_ceinture_de_Paris
[7]: https://fr.wikipedia.org/wiki/Ligne_de_Petite_Ceinture
